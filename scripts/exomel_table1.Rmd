---
title: "exomel clinical info"
author: "Caroline Wheeler"
date: "7/26/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(tableone)
```

Add histology, stage, treatment type, median PFS
		Strat by response and p-value (tableone)...fischers exact?
		
Need to resolve additional variables
		
```{r}
response <- read.table("/fs/ess/PAS1695/projects/exorien/data/IO_NOVA_clin.txt", header = TRUE) %>%
  rename("RNASeq" = Sample_ID) %>%
  filter(Cancer_Type == "Melanoma")

clin <- read.csv("/fs/ess/PAS1695/projects/exorien/data/clinical/20PRJ060OSU_20210712_ClinicalMolLinkage_V4.csv") %>%
  rename("AvatarKey" = ORIENAvatarKey)

extra_clin <- read.csv("/fs/ess/PAS1695/projects/exorien/data/clinical/20PRJ060OSU_20210712_PatientMaster_V4.csv")

hist <- read.csv("/fs/ess/PAS1695/projects/exorien/data/clinical/20PRJ060OSU_20210712_PatientHistory_V4.csv")

clin <- merge(response, clin)
clin <- merge(clin, extra_clin)
clin <- merge(clin, hist)

# diagnosis <- read.csv("/fs/ess/PAS1695/projects/exorien/data/clinical/20PRJ060OSU_20210712_Diagnosis_V4.csv") %>%
#   filter(AvatarKey %in% clin$AvatarKey) %>%
#   select(AvatarKey, Histology) %>%
#   distinct()

# meds <- read.csv("/fs/ess/PAS1695/projects/exorien/data/clinical/20PRJ060OSU_20210712_Medications_V4.csv") %>%
#   filter(AvatarKey %in% clin$AvatarKey) %>%
#   select(AvatarKey, Medication) %>%
#   distinct()
# 
# meds %>% select(Medication) %>% distinct()
# 
# outcomes <- read.csv("/fs/ess/PAS1695/projects/exorien/data/clinical/20PRJ060OSU_20210712_Outcomes_V4.csv") %>%
#   filter(AvatarKey %in% clin$AvatarKey) %>%
#   select(AvatarKey, )

# clin <- merge(clin, meds)
# clin <- merge(clin, outcomes)
# clin <- merge(clin, diagnosis)

```

```{r}
table(clin$Response)
table(clin$Sex)
table(clin$Age.At.Specimen.Collection)
# table(clin$Histology)
# table(clin$ClinGroupStage)
```

```{r}
clin <- clin %>%
  mutate(Response = ifelse(Response == 0, "Non-Responder", "Responder"),
         Age = case_when(Age.At.Specimen.Collection >= 80  & Age.At.Specimen.Collection <= 89.99 ~ '80-89',
                         Age.At.Specimen.Collection >= 70  & Age.At.Specimen.Collection <= 79.99 ~ '70-79',
                         Age.At.Specimen.Collection >= 60  & Age.At.Specimen.Collection <= 69.99 ~ '60-69',
                         Age.At.Specimen.Collection >= 50  & Age.At.Specimen.Collection <= 59.99 ~ '50-59',
                         Age.At.Specimen.Collection >= 40  & Age.At.Specimen.Collection <= 49.99 ~ '40-49',
                         Age.At.Specimen.Collection >= 30  & Age.At.Specimen.Collection <= 39.99 ~ '30-39',
                         Age.At.Specimen.Collection >= 20  & Age.At.Specimen.Collection <= 29.99 ~ '20-29',
                         Age.At.Specimen.Collection >= 10  & Age.At.Specimen.Collection <= 19.99 ~ '10-19',))

```

```{r}
variables_listed <- c( "Age", "Sex", "Race")

cat_vars <- c("Age", "Sex", "Race")

rcc <- CreateTableOne(vars = variables_listed, strata = "Response", data = clin, factorVars = cat_vars)
tab <- print(rcc, noSpaces = TRUE, quote = FALSE, nonnormal = biomarkers, formatOptions = list(big.mark = ","))
#tab <- print(rcc, nonnormal = biomarkers, formatOptions = list(big.mark = ","))
tab
```

```{r}
tab3 <- CreateTableOne(vars = myVars, strata = "trt" , data = pbc, factorVars = catVars)
print(tab3, nonnormal = biomarkers, formatOptions = list(big.mark = ","))
```


